////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// START FIREBASE
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////

firebase.initializeApp(config);

var firestore = firebase.firestore();
var storageRef = firebase.storage().ref();


var usersCollection = firestore.collection("users");
var postsCollection = firestore.collection("posts");
var songsCollection = firestore.collection("songs");
var albumsCollection = firestore.collection("albums");


////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// USER VARIABLES
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////



var inUser = {
    username: "username",
    uid: "uid",
    email: "email",
    publicName: "My Profile",
    followers: ["disco"],
    following: ["disco"],
    photoUrl: "images/profile.png"
};


var sampleSong = {
    name: "Song Name",
    artist: "Artist",
    featuring: false,
    vibes: "#Vibes",
    date: "Date",
    cover: "images/coverArt.png",
    explicit: false,
    likes: 0,
    shares: 0,
    saves: 0
};

////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// NAVIGATION
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////

function toggleFeedSpinner() { 

    var spinner = document.getElementById("feedSpinner");

    if (spinner.classList.contains("d-none")){
        
    }
    


 }


function leftbarNavigate() {
    var newLocation = window.location.hash;



    var feed = newLocation.replace('#', '');
 
    console.log(feed);


    if (feed == "NewReleases") {
        // 
        document.getElementById("feedTitle").innerHTML = "New Releases";
        document.getElementById("feedSource").innerHTML = "Everyone";


    }
    if (feed == "Home") {

        //
        document.getElementById("feedTitle").innerHTML = feed;
        document.getElementById("feedSource").innerHTML = "Friends";


    }

}


////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// USER DATA
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////



function getUser() {



}

function setPhotoUrl(url) {
    inUser.photoUrl = url;

}


function showFollowers() {
    $('#followersModal').modal('toggle');

}




////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// AUDIO PLAYER
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////


function newPlaying(playing) {
    sampleSong = playing;
}


function pushPlaying(song) {

    var playingRef = firebase.database().ref('users/' + inUser.username + '/player/playing');

    playingRef.set(song);

    var audioPlayer = document.getElementById("audioPlayer");
    audioPlayer.play();

}




////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// FEED LOGIC
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////








////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// START DISCO
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////




// Get User Info
firebase.auth().onAuthStateChanged(function (user) {
    if (user) {
        // User is signed in.

        inUser.username = user.displayName;
        inUser.uid = user.uid;
        inUser.email = user.email;
        var userRef = usersCollection.doc(inUser.username);
        userRef.get().then(function (doc) {
            if (doc.exists) {
                inUser = doc.data();
    
                storageRef.child('profileImages/' + inUser.uid).getDownloadURL().then(function (url) {
                    setPhotoUrl(url);
                    console.log("Welcome back " + inUser.publicName);
                }).catch(function (error) {
                    // Handle any errors
                });
    
            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }
        }).catch(function (error) {
            console.log("Error getting document:", error);
        });
    
        var playingRef = firebase.database().ref('users/' + inUser.username + '/player/playing');

        playingRef.on('value', function (snapshot) {
            var playing = snapshot.val();

            newPlaying(playing);

        });

    } else {
        // No user is signed in.
    }
});
